<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vanilla JavaScript II | JS Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="JeongShin 의 코딩 블로그 👨🏻‍💻">
    <meta name="google-site-verification" content="66JKoxw93huqhAdXO3P0K86NJZne5H-M3302YHcwoWI">
    <link rel="preload" href="/JeongShin_Blog/assets/css/0.styles.a7461271.css" as="style"><link rel="preload" href="/JeongShin_Blog/assets/js/app.0fecb38f.js" as="script"><link rel="preload" href="/JeongShin_Blog/assets/js/2.b04f9bcd.js" as="script"><link rel="preload" href="/JeongShin_Blog/assets/js/7.18765801.js" as="script"><link rel="prefetch" href="/JeongShin_Blog/assets/js/10.88ecb350.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/11.72bcfd3c.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/12.fb8f33a9.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/13.bf112f52.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/14.71a5b228.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/15.3b8b5474.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/16.992321a6.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/17.7a891a47.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/18.422c99a4.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/19.ba03b0e2.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/20.20c36497.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/21.1a8776b5.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/22.65b409a8.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/23.d3fc09c5.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/24.b29195fb.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/25.6c5e6b29.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/26.d74d1141.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/27.35b85592.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/28.79101a52.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/29.072ce91a.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/3.e331561d.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/4.8b294d63.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/5.c30eff67.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/6.f2520594.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/8.74bf80c9.js"><link rel="prefetch" href="/JeongShin_Blog/assets/js/9.c657e5f9.js">
    <link rel="stylesheet" href="/JeongShin_Blog/assets/css/0.styles.a7461271.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JeongShin_Blog/" class="home-link router-link-active"><img src="/JeongShin_Blog/images/logo.jpg" alt="JS Blog" class="logo"> <span class="site-name can-hide">JS Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JeongShin_Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/JeongShin_Blog/home/" class="nav-link">
  
</a></div><div class="nav-item"><a href="/JeongShin_Blog/aboutme/" class="nav-link">
  About me
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JeongShin_Blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/JeongShin_Blog/home/" class="nav-link">
  
</a></div><div class="nav-item"><a href="/JeongShin_Blog/aboutme/" class="nav-link">
  About me
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/JeongShin_Blog/guide/" class="sidebar-link">Guide</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/JeongShin_Blog/TIL/" class="sidebar-heading clickable router-link-active open"><span>Today I Learned</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/JeongShin_Blog/TIL/study/" aria-current="page" class="sidebar-link">WEB Basics</a></li><li><a href="/JeongShin_Blog/TIL/study/JavaScript.html" class="sidebar-link">Vanilla JavaScript</a></li><li><a href="/JeongShin_Blog/TIL/study/JavaScript2.html" aria-current="page" class="active sidebar-link">Vanilla JavaScript II</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JeongShin_Blog/TIL/study/JavaScript2.html#step-7" class="sidebar-link">Step 7</a></li></ul></li><li><a href="/JeongShin_Blog/TIL/study/Intern.html" class="sidebar-link">인썸니아 인턴</a></li><li><a href="/JeongShin_Blog/TIL/study/db.html" class="sidebar-link">데이터베이스</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/JeongShin_Blog/algorithms/" class="sidebar-heading clickable"><span>Algorithms</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/JeongShin_Blog/book-review/" class="sidebar-heading clickable"><span>Book-Review</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/JeongShin_Blog/daily/" class="sidebar-heading clickable"><span>Daily</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vanilla-javascript-ii"><a href="#vanilla-javascript-ii" class="header-anchor">#</a> Vanilla JavaScript II</h1> <h2 id="step-7"><a href="#step-7" class="header-anchor">#</a> Step 7</h2> <p>자바스크립트는 기본적으로 Single Threaded 이다. 따라서 동시에 두가지 일을 하지는 못한다.</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">delayBySeconds</span><span class="token punctuation">(</span><span class="token parameter">sec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> start <span class="token operator">&lt;</span> <span class="token punctuation">(</span>sec <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">delayBySeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>위와 같은 코드를 실행하면 자바스크립트의 메인 쓰레드는 5초간 다른 작업을 수행하지 못한다. 즉 blocking 되어 있는 상태이다.</p> <p>따라서 시간이 오래 걸리거나 어떤 응답을 기다리는 함수 등은 비동기적으로 처리해야한다.</p> <p>콜백 함수에 대해 알아보기 전에 먼저 자바스크립트 메모리 구조에 대해 알아보자.</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">LevelTwo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Inside Level Two ! '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">LevelOne</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">LevelTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">LevelOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>다음과 같이 함수를 실행할 때 자바스크립트 call stack 은 아래와 같이 된다.</p> <table><thead><tr><th style="text-align:center;">Tables</th></tr></thead> <tbody><tr><td style="text-align:center;">console.log</td></tr> <tr><td style="text-align:center;">LevelTwo</td></tr> <tr><td style="text-align:center;">LevelOne</td></tr> <tr><td style="text-align:center;">main</td></tr></tbody></table> <h4 id="web-apis"><a href="#web-apis" class="header-anchor">#</a> Web APIs</h4> <p>Web API 는 DOM, Ajax(네트워크 리퀘스트), setTimeout() 등의 main thread 에서는 수행하기 어려운 작업들을 수행을 돕는 API 이다. Web API를 통하여 mutiple thread 로 작업이 가능하다.</p> <h3 id="js-event-loop"><a href="#js-event-loop" class="header-anchor">#</a> JS Event Loop</h3> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>위의 함수가 실행되면 Web APIs 로 해당 함수 작업을 한다. 그러다 5초가 지나면 Event Queue 에 func가 push 되고 Stack 에 모든 함수가 종료되면 Event Queue 에서 func 함수를 가져와 수행한다.</p> <p><img src="/JeongShin_Blog/assets/img/eventloop.de94c7fe.png" alt="eventloop"></p> <p>console.log 함수가 실행되고 난 뒤 위에서부터 하나씩 스택에서 종료되며 없어진다.</p> <h3 id="동기-vs-비동기-프로그래밍"><a href="#동기-vs-비동기-프로그래밍" class="header-anchor">#</a> 동기 vs 비동기 프로그래밍</h3> <p><code>동기적인 코드</code>는 현재 실행 중인 코드가 완료된 후 다음 코드를 실행하는 일반적인 방식이다. 동기적 코드는 CPU 계산에 의해 즉시 처리가 가능하다.</p> <p><code>비동기적인 코드</code>는 현재 실행 중인 코드의 완료 여부와 무관하게 즉시 다음 코드로 넘어간다. 이는 사용자 요청에 의해 특정 시간을 대기하거나 (setTimeout), 사용자의 직접적인 개입이 있을때 함수를 실행하도록 대기하거나(addEvenListener), 웹 브라우저가 아닌 별도 대상에 요청하는(XMLHttpRequest) <strong>별도의 요청, 실행 대기, 보류</strong> 등과 관련된 코드이다.</p> <p>웹에서 비동기적인 코드의 비중이 높아진 만큼 콜백 지옥에 빠지지 않기위해 다음과 같은 방식의 코딩이 도입 되었다.</p> <h4 id="es6-promise-generator"><a href="#es6-promise-generator" class="header-anchor">#</a> ES6 Promise, Generator</h4> <p>ES6에 등장한 Promise 를 이용한 방식은 new 연산자와 함께 호출한 Promise 의 인자로 넘겨주는 콜백 함수는 호출할 때 바로 실행되지만 <strong>그 내부에 resolve 또는 reject 함수를 호출하는 구문이 있을 경우 둘 중 하나가 실행되기 전까지는 then 또는 catch 구문으로 넘어가지 않는다</strong>.</p> <p>따라서 비동기 작업이 완료될 때 비로소 resolve 또는 reject 를 호출 하는 방법으로 비동기적인 작업을 할 수 있다.</p> <p>0.5 초마다 커피 목록을 수집하고 출력하는 코드를 Promise를 이용하여 다음과 같이 코딩할 수 있다.</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">addCoffee</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prevName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> newName <span class="token operator">=</span> prevName <span class="token operator">?</span> <span class="token punctuation">(</span>prevName <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> name<span class="token punctuation">)</span> <span class="token operator">:</span> name<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>수행 결과</p> <p><img src="/JeongShin_Blog/assets/img/promise.db6a75ff.png" alt="Promise"></p> <h4 id="es7-async-await"><a href="#es7-async-await" class="header-anchor">#</a> ES7 async, await</h4> <p>ES7 부터 추가된 새로운 기능인 async, await 는 비동기 작업을 수행하고자 하는 함수 앞에 async 를 표기하고 함수 내부에서 실질적인 비동기 작업이 필요한 위치마다 await 를 표기하는 것만으로 뒤의 내용을 Promise 로 자동 전환하고, 해당 내용이 resolve 된 이후 진행 된다.</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">addCoffee</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">coffeeMaker</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> coffeeList <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">_addCoffee</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    coffeeList <span class="token operator">+=</span> <span class="token punctuation">(</span>coffeeList <span class="token operator">?</span> <span class="token string">','</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">await</span> <span class="token function">addCoffee</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">_addCoffee</span><span class="token punctuation">(</span><span class="token string">'에스프레소'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffeeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">_addCoffee</span><span class="token punctuation">(</span><span class="token string">'아메리카노'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffeeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">_addCoffee</span><span class="token punctuation">(</span><span class="token string">'카페모카'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffeeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">_addCoffee</span><span class="token punctuation">(</span><span class="token string">'카페라떼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffeeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>수행 결과
<img src="/JeongShin_Blog/assets/img/async.9da547a2.png" alt="async example"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/JeongShin_Blog/TIL/study/JavaScript.html" class="prev">
        Vanilla JavaScript
      </a></span> <span class="next"><a href="/JeongShin_Blog/TIL/study/Intern.html">
        인썸니아 인턴
      </a>
      →
    </span></p></div>  <div><div id="comment"></div></div></main> <footer class="siteFooter">
  COPYRIGHT©2020 ALL RIGHT JeongShin
  <br>sjeong1127@gmail.com . +82-10-2169-2142 .
  <br> <a href="https://www.instagram.com/jeongshin96/" target="_blank">Instagram</a> <a href="https://github.com/JeongShin" target="_blank">GitHub</a></footer></div><div class="global-ui"></div></div>
    <script src="/JeongShin_Blog/assets/js/app.0fecb38f.js" defer></script><script src="/JeongShin_Blog/assets/js/2.b04f9bcd.js" defer></script><script src="/JeongShin_Blog/assets/js/7.18765801.js" defer></script>
  </body>
</html>
